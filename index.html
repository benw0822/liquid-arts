<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Arts - Visual Experience</title>
    <meta name="description"
        content="以世界各地的酒吧為切點，延伸至空間設計、調酒文化、在地風土與生活哲學。講述人與酒的故事、城市的靈魂與夜色的語言。Liquid Arts, Where The Night Becomes Art.">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <!-- Cropper.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="container nav-content" style="display: flex; align-items: center; justify-content: space-between;">
            <a href="index.html" class="logo">
                <img src="assets/logo_horizontal.png" alt="Liquid Arts" class="logo-img">
            </a>

            <!-- Desktop Nav Links -->
            <div class="nav-links" style="margin-left: 2rem;">
                <a href="bars.html" class="nav-link">Bars</a>
                <a href="map.html" class="nav-link">Map</a>
                <a href="journal.html" class="nav-link">Journal</a>
                <a href="events.html" class="nav-link">Event</a>
                <a href="msg.html" class="nav-link">Messages</a>
                <a href="about.html" class="nav-link">About</a>
            </div>

            <!-- Global Auth Button (Mobile & Desktop) -->
            <a href="profile.html" id="global-auth-btn" class="nav-link" aria-label="Profile"
                style="margin-left: auto; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; color: var(--text-accent);">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </a>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-split">
        <div class="hero-text-side">
            <img src="assets/logo_vertical.png" alt="Liquid Arts" class="hero-logo">
            <p class="hero-subtitle">
                以世界各地的酒吧為切點，延伸至空間設計、調酒文化、在地風土與生活哲學。講述人與酒的故事、城市的靈魂與夜色的語言。Liquid Arts, Where The Night Becomes Art.
            </p>
            <div style="margin-top: 2rem;">
                <a href="bars.html" class="btn">Explore Collection</a>
            </div>
        </div>
        <div class="hero-image-side">
            <img src="assets/gallery_3.png" alt="Atmospheric Bar">
        </div>
    </header>

    <main>
        <!-- Featured Bars -->
        <section class="container section-padding">
            <div class="section-header"
                style="border-bottom: none; margin-bottom: 4.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem; text-align: center;">
                <h2 class="display-text" style="font-size: 4rem;">BARS</h2>
            </div>

            <div id="featured-grid" class="masonry-grid">
                <!-- Injected by JS -->
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <a href="bars.html" class="btn"
                    style="color: var(--text-primary); border-color: var(--border-color); padding: 10px 30px;">More
                    Bars</a>
            </div>
        </section>

        <!-- Bartender Section (Dynamic) -->
        <!-- Bartender Section (Poster Style) -->
        <section class="bartender-section"
            style="position: relative; padding: 4rem 0; background: var(--bg-red); color: white; overflow: hidden;">
            <div class="container"
                style="display: flex; flex-direction: column; align-items: center; text-align: center;">

                <!-- Section Title -->
                <h3
                    style="font-family: 'Playfair Display', serif; font-size: 1.2rem; letter-spacing: 4px; color: white; margin-bottom: 2rem; text-transform: uppercase; opacity: 0.9;">
                    MEET TALENT
                </h3>

                <!-- Image Component -->
                <div class="poster-image-container" style="position: relative; margin-bottom: 2rem; margin-top: 1rem;">

                    <!-- Decorative Offset Circle (Left) -->
                    <div
                        style="position: absolute; top: 0; left: -20px; width: 100%; height: 100%; border: 1px solid rgba(255,255,255,0.5); border-radius: 50%; pointer-events: none; z-index: 0;">
                    </div>

                    <!-- Main Image Circle (Right/Center) -->
                    <div
                        style="width: 100%; height: 100%; border-radius: 50%; overflow: hidden; position: relative; z-index: 1; box-shadow: 10px 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2);">
                        <img id="featured-talent-img" src="images/bartender_focus.png" alt="Featured Bartender"
                            style="width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(1.1);">
                    </div>

                    <!-- Curved Text (SVG) - Outside Circle -->
                    <!-- Reset viewBox to 1:1 (320x320) so units = pixels. Allow overflow. -->
                    <svg viewBox="0 0 320 320"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; overflow: visible;">
                        <!-- Path radius 190px (Closer to Image radius 160px). -->
                        <path id="curve" d="M -20,190 A 190,190 0 0,1 190,-20" fill="none" />
                        <text font-family="'Playfair Display', serif" font-size="14" fill="white" letter-spacing="3"
                            text-transform="uppercase">
                            <!-- Adjusted startOffset -->
                            <textPath href="#curve" startOffset="30%" text-anchor="middle">INSIDE QUOTE</textPath>
                        </text>
                    </svg>

                    <!-- Overlay Name -->
                    <div id="featured-talent-name"
                        style="position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); width: 200%; text-align: center; font-family: 'Playfair Display', serif; line-height: 1; z-index: 20; text-shadow: 0 5px 15px rgba(0,0,0,0.5); pointer-events: none; font-style: italic; white-space: nowrap;">
                        PEIPEI
                    </div>
                </div>

                <!-- Content -->
                <div style="max-width: 500px; padding: 0 1rem; position: relative; z-index: 2;">
                    <!-- Role Container (Multiple Bars) (Moved Up) -->
                    <div id="featured-talent-role"
                        style="margin-bottom: 1rem; display: flex; flex-direction: column; align-items: center; width: 100%;">
                        <!-- JS injects <a href...>Bar Name Role</a> here -->
                    </div>

                    <!-- Quote Mark (Serif) (Overlapping Separator) -->
                    <div
                        style="font-family: 'Playfair Display', serif; font-size: 5rem; line-height: 1; margin-bottom: -2.5rem; opacity: 1; color: white; position: relative; z-index: 10; display: inline-block; background: var(--bg-red); padding: 0 10px;">
                        “</div>

                    <!-- Separator (Black) -->
                    <div style="width: 100%; height: 2px; background: #000; margin: 0 auto 1rem auto; opacity: 0.6;">
                    </div>

                    <!-- English Quote -->
                    <h2 id="featured-talent-quote-en"
                        style="font-family: 'Playfair Display', serif; font-size: 1.6rem; font-style: italic; margin-bottom: 0.8rem; font-weight: 400; line-height: 1.4;">
                        An apple a day, keeps the doctor away.
                    </h2>

                    <!-- Chinese Quote -->
                    <p id="featured-talent-desc"
                        style="font-family: var(--font-main); font-size: 1.1rem; margin-bottom: 1.5rem; font-weight: 300; opacity: 0.9; letter-spacing: 1px;">
                        一天一頻果，醫師遠離我。
                    </p>

                    <!-- Bottom Separator (Black) -->
                    <div style="width: 100%; height: 2px; background: #000; margin: 0 auto 0 auto; opacity: 0.6;"></div>

                </div>

            </div>

            </div>
        </section>

        <!-- Feature Section (PeiPei Style) -->
        </div>
        </section>

        <!-- Latest Articles (Journal) -->
        <section class="container section-padding">
            <div class="section-header" style="border-bottom: none; text-align: center; justify-content: center;">
                <h2 class="display-text" style="font-size: 4rem;">JOURNAL</h2>
            </div>
            <div id="article-grid" class="masonry-grid" style="margin-top: 3rem;"> <!-- Added Top Spacing -->
                <!-- Injected by JS -->
            </div>
            <div style="text-align: center; margin-top: 2rem;">
                <a href="journal.html" class="btn"
                    style="color: var(--text-primary); border-color: var(--border-color); padding: 10px 30px;">More
                    Journal</a>
            </div>
        </section>

        <!-- Events Section -->
        <section class="container section-padding" style="padding-top: 0;">
            <div class="section-header" style="border-bottom: none; text-align: center; justify-content: center;">
                <h2 class="display-text" style="font-size: 4rem;">EVENTS</h2>
            </div>
            <div id="event-grid" class="masonry-grid" style="margin-top: 3rem;">
                <!-- Injected by JS -->
            </div>
            <div style="text-align: center; margin-top: 2rem;">
                <a href="events.html" class="btn"
                    style="color: var(--text-primary); border-color: var(--border-color); padding: 10px 30px;">More
                    Events</a>
            </div>
        </section>

        <!-- Hops Section -->
        <section class="container section-padding" style="padding-top: 0;">
            <div class="section-header" style="border-bottom: none; text-align: center; justify-content: center;">
                <h2 class="display-text" style="font-size: 4rem;">HOPS</h2>
            </div>
            <div id="hop-feed" class="masonry-grid" style="margin-top: 3rem;">
                <!-- Injected by JS -->
            </div>
            <!-- Optional: More Hops button if needed, linking to bars/map -->
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="bars.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <!-- Triangle Cocktail Glass -->
                <path d="M12 21v-8"></path>
                <path d="M5 4l7 9 7-9H5z"></path>
                <path d="M7 21h10"></path>
            </svg>
            <span>Bars</span>
        </a>
        <a href="map.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span>Map</span>
        </a>
        <a href="journal.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <!-- Vintage Astronomical Telescope on Tripod -->
                <path d="M6 13L17 4"></path> <!-- Tube Top -->
                <path d="M4 15L15 6"></path> <!-- Tube Bottom -->
                <path d="M4 15L6 13"></path> <!-- Eyepiece cap -->
                <path d="M15 6L17 4"></path> <!-- Lens cap -->
                <path d="M11 10L8 21"></path> <!-- Leg L -->
                <path d="M11 10L14 21"></path> <!-- Leg R -->
            </svg>
            <span>Journal</span>
        </a>
        <a href="events.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>Event</span>
        </a>
        <a href="msg.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>Messages</span>
        </a>
        <a href="profile.html" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>Pocket</span>
        </a>
    </nav>

    <footer>
        <div class="container">
            <img src="assets/logo_vertical.png" alt="Liquid Arts" class="logo-img"
                style="height: 80px; width: auto; margin-bottom: 1rem;">
            <p>&copy; 2024 Liquid Arts. All rights reserved.</p>
            <p style="margin-top: 1rem; font-size: 0.8rem;"><a href="admin.html"
                    style="color: #333; text-decoration: none;">Admin Access</a></p>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script src="js/hopping.js"></script>
    <script src="js/talent_front.js"></script>
    <script>
        // Navbar Scroll Effect
        window.addEventListener('scroll', () => {
            const nav = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        });

        // --- Fetch & Render Latest Hops ---
        async function fetchLatestHops() {
            const grid = document.getElementById('hop-feed');
            if (!grid) return;

            grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #888;">Loading latest hops...</p>';

            try {
                // Step 1: Fetch public hops with Bar data
                const { data: hopsData, error: hopsError } = await window.supabaseClient
                    .from('hoppings')
                    .select('*, bars(id, title)')
                    .eq('is_public', true)
                    .order('hopped_at', { ascending: false })
                    .limit(8);

                if (hopsError) throw hopsError;

                if (!hopsData || hopsData.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #888;">No recent hops found.</p>';
                    return;
                }

                // Step 2: Fetch Users separately
                const userIds = [...new Set(hopsData.map(h => h.user_id).filter(Boolean))];
                let usersMap = {};

                if (userIds.length > 0) {
                    const { data: usersData, error: usersError } = await window.supabaseClient
                        .from('users')
                        .select('id, name, hopper_nickname, hopper_image_url')
                        .in('id', userIds);

                    if (usersData) {
                        usersData.forEach(u => { usersMap[u.id] = u; });
                    }
                }

                // Step 3: Prepare Cache for Gallery (Standardize Object Structure)
                window.latestHops = hopsData.map(hop => {
                    const u = usersMap[hop.user_id];
                    return {
                        ...hop,
                        bar_title: hop.bars?.title || 'Unknown Bar',
                        bar_id: hop.bars?.id,
                        user: u // Attach user object for potential usage
                    };
                });

                // Step 4: Render
                grid.innerHTML = window.latestHops.map(hop => {
                    const dateStr = new Date(hop.hopped_at).toLocaleDateString();
                    const stars = '★'.repeat(hop.rating) + '☆'.repeat(5 - hop.rating);

                    const u = hop.user;
                    const userName = u?.hopper_nickname || u?.name || 'Anonymous';
                    const userAvatar = u?.hopper_image_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=random`;

                    const descEsc = hop.description ? hop.description.replace(/'/g, "\\'") : '';
                    const titleEsc = hop.bar_title.replace(/'/g, "\\'");

                    // Use openGenericHoppingGallery for consistent "Gallery" experience (arrows)
                    return `
                    <div class="art-card" onclick="if(window.openGenericHoppingGallery) window.openGenericHoppingGallery(event, '${hop.id}', 'latestHops'); else window.showHoppingDetails(event, '${hop.image_url}', '${hop.hopped_at}', '${hop.rating}', '${descEsc}', '${hop.id}', '${hop.user_id}', false, '${titleEsc}', '${hop.bar_id}')" style="cursor: pointer; position: relative; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: transform 0.3s; display: flex; flex-direction: column;">
                        
                        <!-- Image -->
                        <div style="width: 100%; aspect-ratio: 1/1; overflow: hidden;">
                            <img src="${hop.image_url}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                        </div>

                        <!-- Content -->
                        <div style="padding: 1.2rem; flex: 1; display: flex; flex-direction: column;">
                            <!-- Header: User & Date -->
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.8rem;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <img src="${userAvatar}" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">
                                    <span style="font-size: 0.85rem; font-weight: 600; color: #333;">${userName}</span>
                                </div>
                                <span style="font-size: 0.75rem; color: #888;">${dateStr}</span>
                            </div>

                            <!-- Bar Title -->
                            <h3 style="font-family: var(--font-display); font-size: 1.2rem; margin: 0 0 0.4rem 0; color: #1b1b1b; line-height: 1.3;">${hop.bar_title}</h3>
                            
                            <!-- Rating -->
                            <div style="color: var(--bg-red); font-size: 1rem; margin-bottom: 0.6rem; letter-spacing: 1px;">${stars}</div>

                            <!-- Description (Truncated) -->
                            <p style="font-size: 0.9rem; color: #666; font-style: italic; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin: 0;">
                                "${hop.description || 'Checking in...'}"
                            </p>
                        </div>
                    </div>
                    `;
                }).join('');

            } catch (err) {
                console.error('Error fetching hops:', JSON.stringify(err, null, 2));
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #ef4444;">Could not load recent hops.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', fetchLatestHops);
    </script>
</body>
<!-- Force Sync: 2025-12-09 01:28 -->

</html>
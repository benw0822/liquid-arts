<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Arts BMS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Cropper.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    color: #333;
    padding-bottom: 80px;
    }

    .cms-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    }

    @media (max-width: 768px) {
    .cms-container {
    grid-template-columns: 1fr;
    }
    }

    .cms-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: #fff;
    border-bottom: 1px solid #ddd;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    position: sticky;
    top: 0;
    z-index: 1001;
    }

    h2 {
    color: #111;
    margin: 0;
    }

    .editor-wrapper {
    background: #fff;
    color: #000;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid #e0e0e0;
    }

    .info-panel {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    height: fit-content;
    position: sticky;
    top: 100px;
    }

    .info-label {
    display: block;
    font-weight: 600;
    margin-bottom: 5px;
    color: #555;
    font-size: 0.9rem;
    }

    .search-input,
    .form-input,
    textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1rem;
    margin-bottom: 10px;
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
    }

    textarea {
    resize: vertical;
    min-height: 150px;
    line-height: 1.6;
    }

    .action-btn {
    background-color: #8a0000;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
    }

    .action-btn:hover {
    background-color: #600000;
    }

    .secondary-btn {
    background-color: #eee;
    color: #333;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 10px;
    }

    .secondary-btn:hover {
    background-color: #ddd;
    }

    /* Cover Image Preview */
    .cover-preview {
    width: 100%;
    aspect-ratio: 4 / 5;
    background-color: #eee;
    background-size: cover;
    background-position: center;
    border-radius: 4px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #888;
    border: 2px dashed #ccc;
    cursor: pointer;
    position: relative;
    }

    .cover-preview:hover {
    border-color: #8a0000;
    color: #8a0000;
    }

    /* Loading Overlay */
    #loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    flex-direction: column;
    }

    .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #8a0000;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 10px;
    }

    @keyframes spin {
    0% {
    transform: rotate(0deg);
    }

    100% {
    transform: rotate(360deg);
    }
    }

    /* Bottom Toolbar */
    .bottom-toolbar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #fff;
    border-top: 1px solid #ddd;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    z-index: 1000;
    }

    .status-indicator {
    font-size: 0.9rem;
    color: #666;
    display: flex;
    align-items: center;
    gap: 8px;
    }

    .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #ccc;
    }
    </style>
</head>

<body>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-text">Processing...</div>
    </div>

    <div class="cms-header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="admin.html" style="text-decoration: none; color: #333; font-weight: bold;">&larr; Back</a>
            <h2>Bar Management System</h2>
        </div>
        <div style="font-size: 0.9rem; color: #666;">
            Logged in as: <span id="user-email">Loading...</span>
        </div>
    </div>

    <div class="cms-container">
        <!-- Left Column: Main Info & Media -->
        <div class="main-column">
            <!-- Basic Info Card -->
            <div class="info-panel" style="margin-bottom: 20px; position: static;">
                <h3 style="margin-top: 0; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    Basic Info</h3>

                <div style="margin-bottom: 1.5rem;">
                    <label class="info-label">Bar Name</label>
                    <input type="text" id="bar-title" class="form-input" placeholder="e.g. Midnight Mixology">
                </div>

                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1; margin-bottom: 1.5rem;">
                        <label class="info-label">Vibe</label>
                        <input type="text" id="bar-vibe" class="form-input" placeholder="e.g. Speakeasy, Jazz">
                    </div>
                    <div style="flex: 1; margin-bottom: 1.5rem;">
                        <label class="info-label">Price Level</label>
                        <select id="bar-price" class="form-input">
                            <option value="1">$ (Affordable)</option>
                            <option value="2">$$ (Moderate)</option>
                            <option value="3">$$$ (High End)</option>
                        </select>
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label class="info-label">Description</label>
                    <textarea id="bar-description"
                        placeholder="Describe the atmosphere, concept, and what makes this bar special..."></textarea>
                </div>
            </div>

            <!-- Media Card -->
            <div class="info-panel" style="position: static;">
                <h3 style="margin-top: 0; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    Media</h3>

                <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                    <!-- Cover Image -->
                    <div style="width: 200px; flex-shrink: 0;">
                        <label class="info-label">Cover Image (4:5)</label>
                        <div class="cover-container" style="position: relative;">
                            <div id="cover-preview" class="cover-preview">
                                <span style="pointer-events: none;">Upload</span>
                            </div>
                            <div id="cover-actions" class="cover-actions-overlay"
                                style="display: none; position: absolute; bottom: 10px; right: 10px; gap: 5px;">
                                <button id="btn-upload-cover" class="btn btn-sm btn-primary"
                                    style="font-size: 0.7rem; padding: 4px 8px; background: #8a0000; color: white; border: none; border-radius: 4px; cursor: pointer;">Up</button>
                                <button id="btn-crop-cover" class="btn btn-sm btn-secondary"
                                    style="font-size: 0.7rem; padding: 4px 8px; background: white; color: #333; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Crop</button>
                            </div>
                            <input type="file" id="cover-file" accept="image/*" style="display: none;">
                        </div>
                        <p class="help-text" style="font-size: 0.75rem; color: #888; margin-top: 5px;">1080x1350px</p>
                    </div>

                    <!-- Gallery -->
                    <div style="flex: 1; min-width: 250px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <label class="info-label" style="margin-bottom: 0;">Gallery Images</label>
                            <button id="btn-add-gallery" class="secondary-btn"
                                style="padding: 5px 10px; font-size: 0.8rem;">+ Add</button>
                            <input type="file" id="gallery-input" accept="image/*" multiple style="display: none;">
                        </div>
                        <div id="gallery-grid"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px;">
                            <div
                                style="grid-column: 1 / -1; text-align: center; color: #999; font-size: 0.9rem; padding: 20px; background: #f9f9f9; border-radius: 4px;">
                                No images yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Sidebar -->
        <div class="side-column">
            <!-- Location Card -->
            <div class="info-panel" style="margin-bottom: 20px; position: static;">
                <h3 style="margin-top: 0; margin-bottom: 15px;">Location</h3>

                <div style="margin-bottom: 1rem;">
                    <label class="info-label">Google Maps URL</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="text" id="bar-map" class="form-input" placeholder="Paste Link..."
                            style="margin-bottom: 0; font-size: 0.9rem;">
                        <button id="btn-load-map" class="secondary-btn"
                            style="padding: 8px 12px; font-size: 0.8rem; white-space: nowrap;">Load</button>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label class="info-label">Address</label>
                    <input type="text" id="bar-address" class="form-input" placeholder="Address..."
                        style="font-size: 0.9rem;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 1rem;">
                    <input type="number" id="bar-lat" class="form-input" step="any" placeholder="Lat"
                        style="font-size: 0.9rem;">
                    <input type="number" id="bar-lng" class="form-input" step="any" placeholder="Lng"
                        style="font-size: 0.9rem;">
                </div>

                <div
                    style="width: 100%; height: 250px; background: #222; border-radius: 4px; overflow: hidden; margin-bottom: 5px;">
                    <div id="map-preview" style="width: 100%; height: 100%; z-index: 1;"></div>
                </div>
                <p class="help-text" style="font-size: 0.75rem; color: #888; margin: 0;">* Ratings depend on Google.</p>
            </div>

            <!-- Ratings Card -->
            <div class="info-panel" style="margin-bottom: 20px; position: static;">
                <h3 style="margin-top: 0; margin-bottom: 15px;">Ratings</h3>

                <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                    <div>
                        <label class="info-label">Google</label>
                        <input type="number" id="bar-google-rating" class="form-input" step="0.1" placeholder="4.5"
                            style="width: 60px;">
                    </div>
                    <div style="flex: 1;">
                        <label class="info-label">Reviews</label>
                        <input type="number" id="bar-google-reviews" class="form-input" placeholder="100">
                    </div>
                </div>

                <div>
                    <label class="info-label">Editorial</label>
                    <div id="editorial-rating-stars"
                        style="display: flex; gap: 5px; cursor: pointer; font-size: 1.5rem; color: #ccc;">
                        <span data-value="1">★</span><span data-value="2">★</span><span data-value="3">★</span><span
                            data-value="4">★</span><span data-value="5">★</span>
                    </div>
                    <input type="hidden" id="bar-editorial-rating" value="0">
                </div>
            </div>

            <!-- Operations Card -->
            <div class="info-panel" style="margin-bottom: 20px; position: static;">
                <h3 style="margin-top: 0; margin-bottom: 15px;">Operations</h3>

                <div style="margin-bottom: 10px;">
                    <label class="info-label">Owner</label>
                    <input type="text" id="bar-owner" class="form-input" placeholder="Name" style="margin-bottom: 5px;">
                </div>
                <div style="margin-bottom: 10px;">
                    <label class="info-label">Bartender</label>
                    <input type="text" id="bar-bartender" class="form-input" placeholder="Name"
                        style="margin-bottom: 5px;">
                </div>
                <div style="margin-bottom: 10px;">
                    <label class="info-label">Phone</label>
                    <input type="text" id="bar-phone" class="form-input" placeholder="Phone"
                        style="margin-bottom: 5px;">
                </div>

                <div style="margin-bottom: 10px;">
                    <label class="info-label">Hours</label>
                    <div id="hours-editor-container"
                        style="border: 1px solid #ddd; padding: 10px; border-radius: 4px; background: #f9f9f9; font-size: 0.9rem;">
                    </div>
                    <button id="btn-add-hours" class="secondary-btn"
                        style="margin-top: 5px; font-size: 0.8rem; width: 100%; padding: 5px;">+ Add</button>
                    <input type="hidden" id="bar-hours">
                </div>
            </div>

            <!-- Links Card -->
            <div class="info-panel" style="position: static;">
                <h3 style="margin-top: 0; margin-bottom: 15px;">Links</h3>
                <input type="text" id="bar-menu" class="form-input" placeholder="Menu URL" style="margin-bottom: 10px;">
                <input type="text" id="bar-instagram" class="form-input" placeholder="Instagram"
                    style="margin-bottom: 10px;">
                <input type="text" id="bar-facebook" class="form-input" placeholder="Facebook"
                    style="margin-bottom: 10px;">
                <input type="text" id="bar-website" class="form-input" placeholder="Website">
            </div>
        </div>
    </div>

    <!-- Bottom Toolbar -->
    <div class="bottom-toolbar">
        <div class="status-indicator">
            <div class="status-dot" id="status-dot"></div>
            <span id="status-text">Ready</span>
        </div>
        <div>
            <button id="cancel-btn" class="secondary-btn">Cancel</button>
            <button id="save-btn" class="action-btn">Save Changes</button>
        </div>
    </div>

    <!-- Crop Modal -->
    <div id="crop-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; justify-content: center; align-items: center; flex-direction: column;">
        <div style="width: 90%; height: 80%; background: #000;">
            <img id="crop-image" style="max-width: 100%; max-height: 100%;">
        </div>
        <div style="margin-top: 20px; display: flex; gap: 15px;">
            <button id="crop-cancel-btn" class="secondary-btn"
                style="background: #333; color: white; border: 1px solid #555;">Cancel</button>
            <button id="crop-save-btn" class="action-btn">Crop & Upload</button>
        </div>
    </div>

    <script src="js/bms.js"></script>
</body>

</html>